<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta name="format-detection" content="telephone=no">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<style>
		body { background-color: #eee;color: #555; }
		button, a { display: block;margin: 20px 0;background: #00CEB9;border: none;color: #fff;line-height: 40px;width: 200px;cursor: pointer;outline: none;text-align: center; }
		button:hover, a:hover { box-shadow: 0 0 5px #33CEB9; }
		button:active, a:active { background: #fff;color: #00CEB9; }
		input { height: 40px;outline: none;width: 300px;text-align: center;font-size: 16px;color: #00CEB9; float: left;border: 1px solid #fff; }
	</style>
</head>

<body>

	<h1>eventCollector 测试</h1>
	<br>
	<br>
	<br>
	<div>
		<input id='testvalue' type='text' placeholder='请输入您的tenantId'/>
		<a id='test' onclick="test()">初始化访客回呼</a>
	</div>


<script>
	window.easemobim = window.easemobim || {};

	easemobim.config = {
		eventCollector: true,
		domain: '//sandbox.kefu.easemob.com',
		hide: false
	};
</script>
<script>
	var tenantIdInput = document.getElementById('testvalue');
	tenantIdInput.value = localStorage.getItem('easemobtest') || '';

	readParams();

	function readParams(){
		var matchResult = location.search.match(/initEventCollector=(\d+)/);
		var tenantId = matchResult && matchResult[1];

		if (tenantId){
			easemobim.config.tenantId = tenantId;
			var script = document.createElement('script');
			script.src = '//sandbox.kefu.easemob.com/webim/easemob.js';
			document.body.appendChild(script);
		}
	}

	function test(){
		var tenantId = tenantIdInput.value;
		tenantId = tenantId && tenantId.replace(/\s/g, '');

		if (/\d+/.test(tenantId)) {
			localStorage.setItem('easemobtest', tenantId);
			initEventCollector(tenantId);
		}
	}

	function initEventCollector(tenantId){
		var params = '?initEventCollector=' + tenantId;
		location.href = location.protocol + '//' + location.host + location.pathname + params;
	}
</script>

</body>
</html>
